# jikanicle プロジェクト現状分析とバックログ

## 更新履歴

| 日付 | 更新者 | 内容 |
|------|--------|------|
| 2025-03-10 | 開発チーム | 既存ドキュメントの統合によるプロジェクトステータスドキュメント作成 |
| 2025-03-10 | 開発チーム | 現在の実装状況の更新と次のスプリント計画の詳細化 |
| 2025-03-10 | 開発チーム | ファイルベースリポジトリ実装完了とZustand状態管理導入準備の追加 |

## 1. 現状分析

### 1.1 実装済み機能（フェーズ1-2完了）

#### 基本設計と初期実装（フェーズ1完了）

- ✅ ドメインモデルの設計: タスク関連の型定義とZodスキーマの統合
- ✅ タスクエンティティの型定義: Category, TaskStatus, Priority, Task 等
- ✅ タスク作成ファクトリ関数: 新規タスクの作成とバリデーション
- ✅ バリデーションスキーマ: Zodを使った堅牢なバリデーション
- ✅ 単体テストの作成: ファクトリ関数とバリデーションのテスト

#### タスク操作と永続化（フェーズ2完了）

- ✅ タスク更新機能の実装: 既存タスクの部分更新と型安全な設計
- ✅ タスク削除機能の実装: 物理削除とリポジトリ連携
- ✅ タスクリポジトリインターフェース定義: Result型を使った型安全なエラーハンドリング
- ✅ インメモリリポジトリの実装: フィルタリング機能とテスト完備
- ✅ 永続ストレージリポジトリの実装: ファイルベース永続化とシリアライズ機能

### 1.2 コードメトリクス

| メトリクス | 値 | 備考 |
|----------|-----|------|
| 実装ファイル数 | 11 | ドメイン: 4, アプリケーション: 1, インフラ: 6 |
| テストファイル数 | 6 | ドメイン: 2, インフラ: 4 |
| 総コード行数 | 約1170行 | テスト除く |
| テスト行数 | 約750行 | |
| テストカバレッジ | 95%以上 | ステートメントカバレッジ |

### 1.3 技術的特徴

- **関数型アプローチ**: `neverthrow`のResult型を使用したエラーハンドリング
- **型安全性**: TypeScriptの高度な型システムを活用した型安全な設計
- **スキーマ検証**: Zodを使用した堅牢なバリデーション
- **テスト駆動開発**: すべての機能に対する包括的なテストケース
- **アダプターパターン**: ファイルシステム操作の抽象化による依存性の分離

### 1.4 技術的アプローチ

- **型定義とバリデーションの統合**: Zodスキーマから直接型を生成し、型定義とバリデーションを一元管理
- **関数型アプローチ**: 状態を持たない純粋関数を使った実装
- **TDDプラクティス**: テスト駆動で実装を進行
- **DDDアーキテクチャ**: ドメイン層、アプリケーション層、インフラストラクチャ層の明確な分離
- **アダプターパターン**: 外部依存をアダプターで抽象化し、テスト容易性を確保

### 1.5 メトリクスとパフォーマンス

- **テストカバレッジ**:
  - ステートメントカバレッジ: 96.55%
  - ブランチカバレッジ: 85.55% (改善済み)
  - 関数カバレッジ: 90%
  - 行カバレッジ: 96.55%

### 1.6 懸念事項と制約

- エラーハンドリングが基本的なレベルにとどまっている
- モジュール間の依存関係管理（循環参照の回避）
- ファイルベースリポジトリのパフォーマンス（大量データ時）

## 2. バックログ

### 2.1 フェーズ2: タスク操作と永続化（優先度: 高）

#### 2.1.1 タスク更新機能の実装

- [x] **タスク更新スキーマの定義**
  - ✅ 完了
  - 部分更新をサポートするZodスキーマの実装
  - 選択的フィールド更新のバリデーションルール

- [x] **タスク更新ファクトリ関数の実装**
  - ✅ 完了
  - 変更履歴の保持
  - 更新日時の自動設定
  - 完了ステータスへの変更時の完了日時設定

- [x] **タスク更新のテスト実装**
  - ✅ 完了
  - 有効な更新のテスト
  - 無効な更新のテスト
  - 部分更新のテスト

- [x] **論理削除vs物理削除の設計決定と記録（ADR）**
  - 削除方針の検討
  - ユースケースの整理
  - ADR作成済み
  - 物理削除の場合: データの完全削除

- [x] **タスク削除関数の実装**
  - 論理削除の場合: 削除フラグと削除日時の追加
  - ✅ 完了
  - 物理削除の場合: データの完全削除

- [x] **削除操作のテスト実装**
  - ✅ 完了
  - 削除操作の検証
  - 削除後の検索結果への影響確認

#### 2.1.3 タスクリポジトリの実装

- [x] **リポジトリインターフェースの定義**
  - CRUD操作の定義
  - クエリ検索のインターフェース

- [x] **インメモリリポジトリの実装**
  - テスト用インメモリストレージと実装完了
  - パフォーマンステスト

- [x] **永続ストレージリポジトリの実装**
  - ✅ 完了
  - ファイルベースの永続化
  - JSONシリアライズ/デシリアライズ
  - ファイルシステムアダプターによる抽象化

### 2.2 技術的負債と改善（優先度: 中）

- [ ] **エラーハンドリングの強化**
  - Result型を使ったエラー処理の統一
  - エラー型の定義と網羅的なエラーメッセージ

- [ ] **テストカバレッジの改善**
  - ブランチカバレッジ向上（現在85.55%）
  - エッジケースのテスト追加

- [ ] **バリデーションロジックの共通化**
  - 再利用可能なバリデーション関数の作成
  - バリデーションの一貫性確保

- [ ] **パフォーマンス最適化**
  - オブジェクト生成の効率化
  - 不要なオブジェクトコピーの削減

### 2.3 フェーズ3: 状態管理とクエリ機能（優先度: 高）

- [ ] **状態管理の導入**
  - Zustandストア設計
  - ドメイン層との連携パターン確立
  - 永続化リポジトリとの同期

- [ ] **検索条件の型定義**
  - フィルタリング条件の型設計
  - ソート条件の型設計

- [ ] **検索条件のZodスキーマ定義**
  - 検索パラメータのバリデーション
  - デフォルト値と制約の設定

## 3. 次のスプリント計画（2025-03-10 〜 2025-03-20）

### 3.1 目標

フェーズ3の「状態管理の導入とクエリ機能」の実装を進め、UIの基本構造に着手する。

### 3.2 実装タスク（優先順）

1. **Zustand状態管理の導入**（最優先）
   - ストア設計
   - ドメイン層との連携パターン確立
   - 基本的なストア実装
   - 想定完了日: 2025-03-16

2. **アプリケーションサービス層の実装**
   - ユースケース定義
   - サービス実装
   - テスト作成
   - 想定完了日: 2025-03-18

3. **高度なクエリ機能の実装**
   - 検索条件の型定義
   - 複合フィルタリングの実装
   - 想定完了日: 2025-03-19

4. **TUIの基本構造実装**
   - メインアプリケーションコンポーネント作成
   - 基本レイアウト実装
   - 想定完了日: 2025-03-20

### 3.3 期待される成果物

- Zustandストア設計とベース実装
- アプリケーションサービス層の基本構造
- 高度なクエリ機能の基本実装
- TUIの基本コンポーネント

## 4. 技術的検討事項

### 4.1 状態管理の実装方針

- **Zustandの選択理由**: 軽量で関数型アプローチと相性が良い
- **ドメインとの連携**: ドメインオブジェクトのイミュータブルな扱い
- **永続化との同期**: リポジトリ操作とストア状態の同期パターン
- **テスト戦略**: ストアの単体テストと結合テスト方針

### 4.2 高度なクエリ実装

- **型安全なクエリビルダー**: 型推論を活用した検索条件の構築
- **パフォーマンス**: インデックス等による検索パフォーマンスの改善
- **ページング**: 大量データの効率的な取得方法

## 5. 全体ロードマップとの整合性

現在の進捗は全体ロードマップのフェーズ1-2が完了し、フェーズ3に着手する段階です：

- ✅ プロジェクト基本設定（package.json, tsconfig.json）
- ✅ ドメインモデルの一部（タスク管理コンテキスト）実装
  - ✅ 共通型定義（src/domain/types/Task.ts）
  - ✅ スキーマ定義（src/domain/schemas/task-schema.ts）
  - ✅ ファクトリ関数実装（src/domain/factories/task-factory.ts）
- ✅ データアクセス層の実装
  - ✅ リポジトリインターフェース（src/application/repositories/task-repository.ts）
  - ✅ インメモリリポジトリ（src/infrastructure/repositories/in-memory-task-repository.ts）
  - ✅ ファイルベースリポジトリ（src/infrastructure/repositories/file-based-task-repository.ts）
  - ✅ ファイルシステムアダプター（src/infrastructure/adapters/file-system-adapter.ts）

フェーズ3（状態管理とクエリ機能）に進むために、次の項目に取り組みます：

1. Zustand状態管理の導入
2. アプリケーションサービス層の実装
3. 高度なクエリ機能の実装
4. UI層の基本構造実装

## 6. 次に取り組むべきアクション

1. **Zustand状態管理の導入**（最優先）
   - Zustandライブラリの導入
   - 基本的なストア設計と実装
   - ドメイン層との連携パターン確立
   - 担当: UI担当者と連携
   - 想定工数: 3人日

2. **アプリケーションサービス層の実装**
   - ユースケース定義とサービス実装
   - 担当: 開発チーム
   - 想定工数: 2人日

3. **高度なクエリ機能の実装**
   - フィルタリングとソートの実装
   - 担当: 開発チーム
   - 想定工数: 2人日

## 7. 2025年3月10日の実装状況サマリー

### 7.1 完了した実装

- ✅ ドメインモデルの設計と実装（タスクエンティティ、スキーマ、ファクトリ）
- ✅ タスク更新・削除機能の実装とテスト
- ✅ リポジトリインターフェースの設計
- ✅ インメモリリポジトリの実装とテスト
- ✅ ファイルベースリポジトリの実装とテスト
- ✅ ファイルシステムアダプターの実装とテスト

### 7.2 進行中の実装

- 🔄 Zustand状態管理の導入（優先度: 高）
  - 設計フェーズ開始
  - ドメイン層との連携パターン検討中
  - 残課題: ストア設計、リポジトリとの同期

### 7.3 今後のマイルストーン

| マイルストーン | 予定日 | 状態 |
|--------------|-------|------|
| Zustand状態管理導入 | 2025-03-16 | 着手予定 |
| アプリケーションサービス層実装 | 2025-03-18 | 未着手 |
| 高度なクエリ機能実装 | 2025-03-19 | 未着手 |
| TUI基本構造実装 | 2025-03-20 | 未着手 |

## 関連ドキュメント

- [プロジェクトロードマップ](./roadmap.md)
- [タスク管理ドメインステータス](../domain/task/status.md)
- [アーキテクチャ概要](../architecture/overview.md)