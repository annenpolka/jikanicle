# jicanicle 設計計画

## 1. アプリケーション概要

### 目的

- ユーザーがタスクを簡単に入力し、AI による所要時間の予測とカテゴリ分類を元に最適なタイムブロックを自動生成する。
- ユーザーは実作業の時間を計測するだけで、効率的なタイムマネジメントを実現できる。

### 特徴

- シンプルな操作 (タスク入力 + 実績記録のみ)
- TUI（ターミナルユーザーインターフェース）により直感的な操作
- AI を活用した予測機能と、予測結果に対するユーザーフィードバック（予測フィードバック）による学習ループ
- DDD（ドメイン駆動設計）とスキーマ駆動開発による型安全な実装

---

## 2. 基本アーキテクチャ

### レイヤー構造

1. **ドメイン層**

   - ビジネスルールや主要なドメイン概念（タスク、タイムブロック、予測フィードバック等）の定義
   - zod によるスキーマ定義を用いて、データ構造の検証と型安全性の確保
   - ファクトリ関数と状態変更（開始、完了等）のコマンド関数を実装

2. **アプリケーション層**

   - ユースケース実現のためのアプリケーションサービス (タスク作成、実績記録、予測フィードバックの追加等) を提供
   - ドメイン層のリポジトリインターフェースを利用してデータ操作を行う

3. **インフラストラクチャ層**
   - JSON ファイルを用いたデータストレージ（将来的には SQLite などへの拡張を検討）
   - 外部 AI API（例：OpenAI API）との連携による所要時間の予測とカテゴリ分類
   - blessed または neo-blessed を用いた TUI 実装

---

## 3. ドメインモデル・ユビキタス言語

### 主要エンティティ

- **タスク（WorkItem）**

  - 属性: ID, 名前, 説明, 予測所要時間, 実績時間, カテゴリ, 状態 (未開始, 進行中, 完了, 延期), 作成日時, 完了日時

- **タイムブロック（ScheduleSlot）**

  - 属性: ID, 関連タスク ID, 開始時刻, 終了時刻, 完了フラグ

- **予測フィードバック（PredictionFeedback）**

  - 属性: フィードバックの種類 (TOO_SHORT, TOO_LONG, ACCURATE, UNCERTAIN), ユーザーコメント（任意）, 作成日時

- **スケジュール（Schedule）**

  - 属性: 日付と当日のタイムブロック集合

- **タイムトラッキング**
  - タスクの開始、一時停止、完了操作を通して実績時間を記録

### 用語の統一

- タスク (WorkItem)、タイムブロック (ScheduleSlot) など、ドメイン概念を反映した名称を採用
- 予測フィードバック：ユーザーが予測結果に対してフィードバックを付与する機能

---

## 4. 機能仕様

### タスク管理機能

- ユーザーがタスク名および任意の説明を入力
- AI が入力内容から所要時間とカテゴリを予測し、タスク作成
- タスクは JSON ファイルに保存し、一覧表示や詳細表示が可能

### タイムブロッキング機能

- 指定された時間枠（例：1 日の勤務時間）に合わせ、各タスクの予測所要時間を元にタイムブロックを自動生成
- タイムブロックは開始時刻・終了時刻が計算され、スケジュール内に配置される

### タイムトラッキング機能

- キー操作（例：開始：s、停止：p、終了：e）でタスクの実績時間を計測
- 記録された実績時間を AI の学習データとして活用

### 予測フィードバック機能

- ユーザーは、AI の予測結果に対し「短すぎる／長すぎる／適切／不確か」といったフィードバックを提供
- フィードバック情報はタスクに紐付けられ、保存後に AI モデルの学習に利用
- フィードバックの統計情報を分析し、予測アルゴリズム調整に反映

---

## 5. 技術スタックと命名規約

### 技術スタック

- **バックエンド**: Node.js, TypeScript
- **型定義／バリデーション**: zod
- **UI**: blessed/neo-blessed (TUI 実装)
- **データストレージ**: 初期は JSON ファイル、将来的には SQLite 等
- **AI 統合**: 外部 AI API (例: OpenAI API)

### 命名規約

- アプリケーション名は「jicanicle」
- ドメインモデルおよびサービスの名称は、WorkItem, ScheduleSlot, TaskDurationPredictor, SchedulePlanner など、ドメイン概念を反映
- 一般的な関数・変数・リポジトリの命名は、getTaskById, storeTask, updateTask, createTaskManager など一貫したルールを採用

---

## 6. プロジェクト構造

```
src/
├── domain/              // ビジネスロジック
│   ├── schemas/         // task-schemas.ts, schedule-schemas.ts
│   ├── types/           // task-types.ts, schedule-types.ts
│   ├── factories/       // task-factory.ts
│   ├── commands/        // task-commands.ts
│   └── services/        // task-duration-predictor.ts, schedule-planner.ts
├── application/         // ユースケース実装
│   ├── repositories/    // task-repository.ts, schedule-repository.ts
│   └── services/        // task-manager.ts, schedule-manager.ts
├── infrastructure/      // 外部連携及びUI
│   ├── repositories/    // file-task-repository.ts, file-schedule-repository.ts
│   ├── ai/              // openai-client.ts
│   └── ui/              // tui-app.ts, task-view.ts, schedule-view.ts
└── index.ts
```

---

## 7. 将来の拡張性と改善ポイント

- **分析機能**: タスク完了パターンやフィードバック統計の可視化、レポート生成
- **外部カレンダー連携**: Google Calendar などとの統合によるスケジュール管理
- **ワークフロー拡張**: ポモドーロなど、集中セッションと休憩タイムの組み込み
- **ローカル AI 予測エンジン**: オフラインでも予測可能な軽量モデルの導入検討
- **マルチデバイス同期**: クラウド連携により複数デバイスでの一貫管理

---

## 8. まとめ

本設計計画は、シンプルかつ拡張性の高いタイムブロッキング TUI アプリケーション「jicanicle」を実現するための基本方針および技術仕様を示しています。AI による予測機能とフィードバック機構を活用し、ユーザーの実績から学習することで、より精度の高い時間管理支援を目指します。

---

## 9. 参考資料

この設計計画は、以下の元テキスト『Dead Simple Time Blocking With AI\_ TUI アプリケーションの要件分.md』をもとに作成されました。

元テキストには、以下の詳細なアプリケーション要件、ドメインモデル定義、ユビキタス言語、命名規約などが記載されており、これらの情報を基に本計画が策定されています。

(元テキストの内容は、プロジェクト初期の設計ドキュメントとして参照されました。)
