# タスク管理ドメイン設計

## 更新履歴

| 日付 | 更新者 | 内容 |
|------|--------|------|
| 2025-03-10 | 開発チーム | 既存設計ドキュメントの統合によるタスクドメイン設計ドキュメント作成 |

## 1. 概要

タスク管理ドメインはjikanicleアプリケーションの中核となるドメインの一つで、ユーザーのタスクを管理します。このドメインは、テキスト入力から始まり、AIによる予測、スケジューリング、実行、完了に至るまでのタスクのライフサイクル全体を担当します。

## 2. ドメインモデル

### 2.1 主要エンティティと値オブジェクト

#### タスク（Task）

タスクはこのドメインの中心的なエンティティです。

**属性**:
- `id`: タスクの一意識別子（UUID）
- `name`: タスク名（1～100文字）
- `description`: タスクの詳細説明（オプショナル）
- `category`: タスクのカテゴリ（列挙型）
- `status`: タスクの状態（列挙型）
- `priority`: タスクの優先度（列挙型）
- `estimatedMinutes`: 予測所要時間（分単位）
- `tags`: タスクに関連するタグのリスト（オプショナル）
- `createdAt`: 作成日時
- `updatedAt`: 最終更新日時
- `completedAt`: 完了日時（オプショナル）

#### カテゴリ（Category）

タスクの分類を表す列挙型です。

**列挙値**:
- `WORK`: 仕事関連
- `PERSONAL_DEV`: 個人の成長や開発に関連
- `HOUSEHOLD`: 家事や家庭関連
- `LEARNING`: 学習や教育関連
- `OTHER`: その他

#### タスクステータス（TaskStatus）

タスクの現在の状態を表す列挙型です。

**列挙値**:
- `NOT_STARTED`: 未開始
- `IN_PROGRESS`: 進行中
- `COMPLETED`: 完了
- `CANCELLED`: キャンセル

#### 優先度（Priority）

タスクの重要度を表す列挙型です。

**列挙値**:
- `LOW`: 低優先度
- `MEDIUM`: 中優先度
- `HIGH`: 高優先度

#### タグ（Tag）

タスクの特性やグループ化のためのキーワードを表す値オブジェクトです。

**属性**:
- `name`: タグ名（1～20文字）

### 2.2 集約

**タスク集約**:

タスクエンティティを中心とした集約で、タスクの作成、更新、削除などの操作を整合的に行うための境界を定義します。

**責務**:
- タスクの整合性の維持
- タスクのライフサイクル管理
- タスク関連の業務ルールの実装

### 2.3 リポジトリ

**タスクリポジトリ**:

タスク集約の永続化と検索を担当するリポジトリです。

**主要操作**:
- タスクの保存（作成/更新）
- タスクの取得（ID検索）
- タスクの削除
- タスクの検索（フィルタリング）

## 3. ドメインルール

### 3.1 タスク作成ルール

- タスク名は必須で、1～100文字である
- カテゴリは必須で、定義された列挙型の値である
- 予測時間は必須で、0分以上の数値である
- タスク作成時のデフォルトステータスは`NOT_STARTED`
- タスク作成時のデフォルト優先度は`MEDIUM`
- 作成日時と更新日時は自動的に現在時刻が設定される

### 3.2 タスク更新ルール

- 更新可能なフィールドは限定的（id, createdAtは変更不可）
- ステータスを`COMPLETED`に変更する場合、completedAtが自動的に設定される
- 更新時はupdatedAtが自動的に現在時刻に更新される
- タスクの部分更新をサポート（変更するフィールドのみ指定可能）

### 3.3 タスク削除ルール

- タスクは物理削除によって完全に削除される
- 削除されたタスクは復元できない

### 3.4 タスク検索ルール

- 複数の条件でフィルタリング可能（カテゴリ、ステータス、優先度など）
- 作成日時、更新日時、完了日時でソート可能
- タグによるフィルタリングが可能

## 4. ファクトリとコマンド

### 4.1 タスク作成ファクトリ

タスクの作成処理を担当するファクトリ関数です。

**入力**:
- タスク作成に必要なデータ（名前、カテゴリ、予測時間など）

**出力**:
- 成功時: 新しいタスクエンティティ
- 失敗時: エラー情報

### 4.2 タスク更新ファクトリ

既存タスクの更新処理を担当するファクトリ関数です。

**入力**:
- 既存のタスクエンティティ
- 更新するフィールドと値

**出力**:
- 成功時: 更新されたタスクエンティティ
- 失敗時: エラー情報

### 4.3 タスク削除コマンド

タスクの削除処理を担当するコマンド関数です。

**入力**:
- 削除するタスクのID

**出力**:
- 成功時: 削除成功の確認
- 失敗時: エラー情報

## 5. サービス

### 5.1 タスク管理サービス

タスクの高レベル操作を提供するサービスです。

**責務**:
- タスクの作成、更新、削除操作の調整
- リポジトリとの連携
- ビジネスルールの適用

### 5.2 タスク検索サービス

タスクの検索と取得に特化したサービスです。

**責務**:
- 複雑な検索条件の処理
- ソートと並べ替え
- ページネーション

## 6. 実装アプローチ

### 6.1 型安全性

- TypeScriptの高度な型システムを活用
- ブランド型とZodを組み合わせた型安全なバリデーション
- 厳格なnullチェックと型ガード

### 6.2 バリデーション

- Zodスキーマによる入力値の検証
- スキーマと型定義の統合
- カスタムバリデーション関数

### 6.3 エラーハンドリング

- Result型（neverthrow）によるエラー処理
- エラー型の階層設計
- 詳細なエラーメッセージと型付きエラー情報

### 6.4 テスト戦略

- ユニットテスト: 各関数の入出力テスト
- 統合テスト: リポジトリとの連携テスト
- プロパティベーステスト: エッジケースの検証

## 7. 関連コンテキストとの連携

### 7.1 タイムブロッキングコンテキストとの関係

- タスク管理コンテキストはタスクエンティティを提供
- タイムブロッキングコンテキストはタスクを参照してスケジュールを生成

### 7.2 タイムトラッキングコンテキストとの関係

- タスク管理コンテキストは作業対象のタスクを提供
- タイムトラッキングコンテキストはタスクの実績時間を記録

### 7.3 AI予測コンテキストとの関係

- タスク管理コンテキストはタスク情報を提供
- AI予測コンテキストはタスクの予測所要時間を推定

## 関連ドキュメント

- [プロジェクトロードマップ](../../project/roadmap.md)
- [タスク管理ドメインステータス](./status.md)
- [タスク管理ドメイン実装詳細](./implementation.md)
- [タスク削除戦略ADR](../../architecture/decisions/task-deletion-strategy.md)