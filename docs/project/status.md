# jikanicle プロジェクト現状分析とバックログ

## 更新履歴

| 日付 | 更新者 | 内容 |
|------|--------|------|
| 2025-03-10 | 開発チーム | 既存ドキュメントの統合によるプロジェクトステータスドキュメント作成 |
| 2025-03-10 | 開発チーム | 現在の実装状況の更新と次のスプリント計画の詳細化 |

## 1. 現状分析

### 1.1 実装済み機能（フェーズ1-2部分完了）

#### 基本設計と初期実装（フェーズ1完了）

- ✅ ドメインモデルの設計: タスク関連の型定義とZodスキーマの統合
- ✅ タスクエンティティの型定義: Category, TaskStatus, Priority, Task 等
- ✅ タスク作成ファクトリ関数: 新規タスクの作成とバリデーション
- ✅ バリデーションスキーマ: Zodを使った堅牢なバリデーション
- ✅ 単体テストの作成: ファクトリ関数とバリデーションのテスト

#### タスク操作と永続化（フェーズ2の一部完了）

- ✅ タスク更新機能の実装: 既存タスクの部分更新と型安全な設計
- ✅ タスク削除機能の実装: 物理削除とリポジトリ連携
- ✅ タスクリポジトリインターフェース定義: Result型を使った型安全なエラーハンドリング
- ✅ インメモリリポジトリの実装: フィルタリング機能とテスト完備

### 1.2 コードメトリクス

| メトリクス | 値 | 備考 |
|----------|-----|------|
| 実装ファイル数 | 7 | ドメイン: 4, アプリケーション: 1, インフラ: 2 |
| テストファイル数 | 3 | ドメイン: 2, インフラ: 1 |
| 総コード行数 | 約950行 | テスト除く |
| テスト行数 | 約650行 | |
| テストカバレッジ | 95%以上 | ステートメントカバレッジ |

### 1.3 技術的特徴

- **関数型アプローチ**: `neverthrow`のResult型を使用したエラーハンドリング
- **型安全性**: TypeScriptの高度な型システムを活用した型安全な設計
- **スキーマ検証**: Zodを使用した堅牢なバリデーション
- **テスト駆動開発**: すべての機能に対する包括的なテストケース

### 1.4 技術的アプローチ

- **型定義とバリデーションの統合**: Zodスキーマから直接型を生成し、型定義とバリデーションを一元管理
- **関数型アプローチ**: 状態を持たない純粋関数を使った実装
- **TDDプラクティス**: テスト駆動で実装を進行
- **DDDアーキテクチャ**: ドメイン層、アプリケーション層、インフラストラクチャ層の明確な分離

### 1.5 メトリクスとパフォーマンス

- **テストカバレッジ**:
  - ステートメントカバレッジ: 96.55%
  - ブランチカバレッジ: 55.55% (要改善)
  - 関数カバレッジ: 75%
  - 行カバレッジ: 96.55%

### 1.6 懸念事項と制約

- ブランチカバレッジが低く、エッジケースに対するテストが不足している可能性
- エラーハンドリングが基本的なレベルにとどまっている
- モジュール間の依存関係管理（循環参照の回避）

## 2. バックログ

### 2.1 フェーズ2: タスク操作と永続化（優先度: 高）

#### 2.1.1 タスク更新機能の実装

- [x] **タスク更新スキーマの定義**
  - ✅ 完了
  - 部分更新をサポートするZodスキーマの実装
  - 選択的フィールド更新のバリデーションルール

- [x] **タスク更新ファクトリ関数の実装**
  - ✅ 完了
  - 変更履歴の保持
  - 更新日時の自動設定
  - 完了ステータスへの変更時の完了日時設定

- [x] **タスク更新のテスト実装**
  - ✅ 完了
  - 有効な更新のテスト
  - 無効な更新のテスト
  - 部分更新のテスト

- [x] **論理削除vs物理削除の設計決定と記録（ADR）**
  - 削除方針の検討
  - ユースケースの整理
  - ADR作成済み
  - 物理削除の場合: データの完全削除

- [x] **タスク削除関数の実装**
  - 論理削除の場合: 削除フラグと削除日時の追加
  - ✅ 完了
  - 物理削除の場合: データの完全削除

- [x] **削除操作のテスト実装**
  - ✅ 完了
  - 削除操作の検証
  - 削除後の検索結果への影響確認

#### 2.1.3 タスクリポジトリの実装

- [x] **リポジトリインターフェースの定義**
  - CRUD操作の定義
  - クエリ検索のインターフェース

- [x] **インメモリリポジトリの実装**
  - テスト用インメモリストレージと実装完了
  - パフォーマンステスト

- [ ] **永続ストレージリポジトリの実装**
  - ファイルベースの永続化
  - JSONシリアライズ/デシリアライズ

### 2.2 技術的負債と改善（優先度: 中）

- [ ] **エラーハンドリングの強化**
  - Result型を使ったエラー処理の統一
  - エラー型の定義と網羅的なエラーメッセージ

- [ ] **テストカバレッジの改善**
  - ブランチカバレッジ向上（現在55.55%）
  - エッジケースのテスト追加

- [ ] **バリデーションロジックの共通化**
  - 再利用可能なバリデーション関数の作成
  - バリデーションの一貫性確保

- [ ] **パフォーマンス最適化**
  - オブジェクト生成の効率化
  - 不要なオブジェクトコピーの削減

### 2.3 フェーズ3準備: クエリと検索（優先度: 低）

- [ ] **検索条件の型定義**
  - フィルタリング条件の型設計
  - ソート条件の型設計

- [ ] **検索条件のZodスキーマ定義**
  - 検索パラメータのバリデーション
  - デフォルト値と制約の設定

## 3. 次のスプリント計画（2025-03-10 〜 2025-03-20）

### 3.1 目標

フェーズ2の「タスク操作と永続化」の実装を完了させ、UIの基本構造に着手する。

### 3.2 実装タスク（優先順）

1. **ファイルベースのリポジトリ実装**（現在進行中）
   - ストレージ選定と実装
   - エラーハンドリング改善
   - 結合テスト作成
   - 想定完了日: 2025-03-13

2. **Zustand状態管理の導入**
   - ストア設計
   - ドメイン層との連携パターン確立
   - 基本的なストア実装
   - 想定完了日: 2025-03-16

3. **アプリケーションサービス層の実装**
   - ユースケース定義
   - サービス実装
   - テスト作成
   - 想定完了日: 2025-03-18

4. **TUIの基本構造実装**
   - メインアプリケーションコンポーネント作成
   - 基本レイアウト実装
   - 想定完了日: 2025-03-20

### 3.3 期待される成果物

- ファイルベースリポジトリ（コード、テスト、ドキュメント）
- Zustandストア設計とベース実装
- アプリケーションサービス層の基本構造
- TUIの基本コンポーネント

## 4. 技術的検討事項

### 4.1 リポジトリパターンの実装方針

- **インターフェースの設計**: 必要最小限のCRUD操作と検索機能に絞る
- **Result型の活用**: すべてのリポジトリ操作でResult<T, E>を返し、エラーを値として扱う
- **トランザクション**: トランザクション境界の設計（アプリケーションサービス層？）

### 4.2 ストレージ選択

- **選択肢**: ファイルシステム、SQLite、インメモリDB
- **永続化要件**: アプリ再起動時のデータ保持、バックアップ、同期
- **パフォーマンス**: 想定されるデータ量とクエリパフォーマンス

## 5. 全体ロードマップとの整合性

現在の進捗は全体ロードマップのフェーズ1（基本インフラの構築）のうち、以下の項目が完了しています：

- ✅ プロジェクト基本設定（package.json, tsconfig.json）
- ✅ ドメインモデルの一部（タスク管理コンテキスト）実装
  - ✅ 共通型定義（src/domain/types/Task.ts）
  - ✅ スキーマ定義（src/domain/schemas/task-schema.ts）
  - ✅ ファクトリ関数実装（src/domain/factories/task-factory.ts）
- ✅ データアクセス層の一部実装
  - ✅ リポジトリインターフェース（src/application/repositories/task-repository.ts）
  - ✅ インメモリリポジトリ（src/infrastructure/repositories/in-memory-task-repository.ts）

フェーズ2（コア機能の実装）に進むために、次の項目に取り組む必要があります：

1. タスク管理の残りの基本機能（タスク更新の完了）
2. 永続化リポジトリの実装
3. UI層の基本構造実装

## 6. 次に取り組むべきアクション

1. **永続化リポジトリの実装**（現在進行中）
   - ファイルベースの永続化機構を実装
   - テストとドキュメントの整備
   - 担当: 開発チーム
   - 想定工数: 3人日

2. **状態管理の導入**
   - Zustandライブラリの導入
   - 基本的なストア設計と実装
   - 担当: UI担当者
   - 想定工数: 2人日

3. **TUI基本構造の実装**
   - メインアプリケーションコンポーネントの作成
   - 基本レイアウトの実装
   - 担当: UI担当者
   - 想定工数: 3人日

## 7. 2025年3月10日の実装状況サマリー

### 7.1 完了した実装

- ✅ ドメインモデルの設計と実装（タスクエンティティ、スキーマ、ファクトリ）
- ✅ タスク更新・削除機能の実装とテスト
- ✅ リポジトリインターフェースの設計
- ✅ インメモリリポジトリの実装とテスト

### 7.2 進行中の実装

- 🔄 ファイルベースのリポジトリ実装（優先度: 高）
  - 設計フェーズ完了
  - 基本実装進行中
  - 残課題: エラーハンドリング、テスト作成

### 7.3 今後のマイルストーン

| マイルストーン | 予定日 | 状態 |
|--------------|-------|------|
| ファイルベースリポジトリ完了 | 2025-03-13 | 進行中 |
| Zustand状態管理導入 | 2025-03-16 | 未着手 |
| アプリケーションサービス層実装 | 2025-03-18 | 未着手 |
| TUI基本構造実装 | 2025-03-20 | 未着手 |

## 関連ドキュメント

- [プロジェクトロードマップ](./roadmap.md)
- [タスク管理ドメインステータス](../domain/task/status.md)
- [アーキテクチャ概要](../architecture/overview.md)