# タスク削除実装 ADR

## ステータス

承認済み

## 日付

2025-03-09

## 背景

タスク管理システムにおいて、不要になったタスクを削除する機能が必要となっています。削除実装方針として、以下の2つのアプローチが検討されました：

1. **物理削除**：データストアからタスクを完全に削除する
2. **論理削除**：削除フラグを立てる等の方法でタスクを非表示にするが、データ自体は保持する

この決定は、システムの長期的な保守性、ユーザー体験、データ管理戦略に影響します。

## 決定

タスク削除は**物理削除**方式で実装します。

理由：
1. 本アプリケーションは個人用タスク管理であり、削除されたタスクの復元ニーズは低いと判断
2. DDDの観点から、タスク集約は完全に削除されるべきエンティティとして定義
3. データの所有権とプライバシーの観点から、ユーザーが削除したデータは完全に削除するべき

## 根拠

### 物理削除の利点

1. **シンプルな実装**:
   - 削除は単純なデータ削除操作として実装できる
   - クエリが単純になり、削除フラグのフィルタリングが不要

2. **スケーラビリティ**:
   - データベースのサイズが不必要に増大しない
   - インデックスのパフォーマンスが維持される

3. **プライバシーとデータ所有権**:
   - ユーザーが望んだ完全なデータ削除が保証される
   - データ保持規制（GDPR等）への対応が容易

4. **ドメインモデルとの整合性**:
   - タスク集約のライフサイクルが明確に表現される
   - 削除されたタスクは存在しないというドメインルールに合致

### 論理削除が必要ではない理由

1. **監査証跡の要件がない**:
   - 本システムは個人用タスク管理であり、厳格な監査要件がない
   - 必要に応じて削除アクションのみをログに記録可能

2. **復元ニーズの低さ**:
   - タスク管理のドメインでは誤削除による重大な影響が少ない
   - 誤削除への対応は、システム側の機能ではなくユーザー確認などで対応する

## 影響

この決定により、以下の影響が予想されます：

### ポジティブな影響

1. コードベースがシンプルになり、保守性が向上
2. パフォーマンスとスケーラビリティの向上
3. データプライバシーに関する要件への対応が容易

### 考慮すべき点

1. 削除されたタスクは復元不可能なため、削除前に確認UIを実装する必要がある
2. 将来的に履歴追跡が必要になった場合は、別の仕組み（イベントソーシング等）の導入を検討

## 実装戦略

1. `domain/commands/delete-task.ts` にタスク削除の関数を実装
2. タスク削除には以下のバリデーションを適用:
   - 存在しないタスクの削除を防止する
   - 削除条件（もしあれば）を検証する
   - エッジケースを適切に処理する

3. Result型を使用したエラーハンドリングを導入:
   - 成功ケース: void (削除成功)
   - 失敗ケース: 適切にタイプ化されたエラーオブジェクト